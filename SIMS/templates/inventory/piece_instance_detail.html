{% extends 'base/base.html' %}

{% block content %}
	{% csrf_token %}
	<div class="card">
  	<div class="card-header">
    Piece Instance Detail
  	</div>
  	<div class="card-body">
		<h5 class="card-title"> CAE Serial Number : {{ piece_instance.serial_number}}</h5>
		<p class="card-text">
  		<p><strong>CAE Part Number:</strong> <a href="{{ piece_instance.piece.get_absolute_url }}">{{ piece_instance.piece.cae_part_number }}</a></p>
  		{% if piece_instance.piece.image %}
  			<p><img src="{{ piece_instance.piece.image.url}}" alt="connect" style="max-height:300px" align="right"></p>
  		{% endif %}
		<p><strong>Calibration document is stored there: </strong> {{ piece_instance.calibration_document }}</p>
  		<p><strong>OEM: </strong> {{ piece_instance.piece.provider }}</p>
  		<p><strong>OEM Serial Number: </strong> {{ piece_instance.provider_serialnumber }}</p>
  		<p><strong>Manufacturer Serial Number: </strong> {{ piece_instance.manufacturer_serialnumber }}</p>
  		<p><strong>Date Created: </strong> {{ piece_instance.date_created }}</p>
		<p><strong>Last Update: </strong> {{ piece_instance.date_update }}</p>
  		<p><strong>Next Calibration: </strong> {{ piece_instance.date_calibration }}</p>
  		<p><strong>End of Life: </strong> {{ piece_instance.date_end_of_life }}</p>
        <p><strong>Location: </strong>{% if piece_instance.eighth_location %}
            <td>{{piece_instance.first_location}}-{{piece_instance.second_location|default_if_none:""}}-{{piece_instance.third_location|default_if_none:""}}-{{piece_instance.fourth_location|default_if_none:""}}-{{piece_instance.fifth_location|default_if_none:""}}-{{piece_instance.sixth_location|default_if_none:""}}-{{piece_instance.seventh_location|default_if_none:""}}-{{piece_instance.eighth_location|default_if_none:""}}</td>
        {% elif piece_instance.seventh_location %}
            <td>{{piece_instance.first_location}}-{{piece_instance.second_location|default_if_none:""}}-{{piece_instance.third_location|default_if_none:""}}-{{piece_instance.fourth_location|default_if_none:""}}-{{piece_instance.fifth_location|default_if_none:""}}-{{piece_instance.sixth_location|default_if_none:""}}-{{piece_instance.seventh_location|default_if_none:""}}</td>
        {% elif piece_instance.sixth_location %}
            <td>{{piece_instance.first_location}}-{{piece_instance.second_location|default_if_none:""}}-{{piece_instance.third_location|default_if_none:""}}-{{piece_instance.fourth_location|default_if_none:""}}-{{piece_instance.fifth_location|default_if_none:""}}-{{piece_instance.sixth_location|default_if_none:""}}</td>
        {% elif piece_instance.fifth_location %}
            <td>{{piece_instance.first_location}}-{{piece_instance.second_location|default_if_none:""}}-{{piece_instance.third_location|default_if_none:""}}-{{piece_instance.fourth_location|default_if_none:""}}-{{piece_instance.fifth_location|default_if_none:""}}</td>
        {% elif piece_instance.fourth_location %}
            <td>{{piece_instance.first_location}}-{{piece_instance.second_location|default_if_none:""}}-{{piece_instance.third_location|default_if_none:""}}-{{piece_instance.fourth_location|default_if_none:""}}</td>
        {% elif piece_instance.third_location %}
            <td>{{piece_instance.first_location}}-{{piece_instance.second_location|default_if_none:""}}-{{piece_instance.third_location|default_if_none:""}}</td>
        {% else %}
            <td>{{piece_instance.first_location}}-{{piece_instance.second_location|default_if_none:""}}</td>
        {% endif %}
  		<p><strong>Status:</strong> {{ piece_instance.status }}</p>
  		<p><strong>History:</strong></p>
		{% for h in piece_instance.history.all %}
   			<p>
			<td>{{ piece_instance }} was </td>
			<td>{{ h.get_history_type_display }} by </td>
			<td><strong>User: </strong>{{ h.history_user }} at <strong>Time : </strong></td>
			<td>{{ h.history_date }} with <strong>Comment: </strong></td>
			{% if h.update_comment %}
				<td>{{ h.update_comment }} </td>
			{% else %}
				<td>No comment given</td>
			{% endif %}
			<td><strong>Status: </strong>{{ h.status }} and <strong>Location: </strong></td>
	  		{% if h.eighth_location %}
	  			<td>{{h.first_location}}-{{h.second_location|default_if_none:""}}-{{h.third_location|default_if_none:""}}-{{h.fourth_location|default_if_none:""}}-{{h.fifth_location|default_if_none:""}}-{{h.sixth_location|default_if_none:""}}-{{h.seventh_location|default_if_none:""}}-{{h.eighth_location|default_if_none:""}}</td>
	  		{% elif h.seventh_location %}
	  			<td>{{h.first_location}}-{{h.second_location|default_if_none:""}}-{{h.third_location|default_if_none:""}}-{{h.fourth_location|default_if_none:""}}-{{h.fifth_location|default_if_none:""}}-{{h.sixth_location|default_if_none:""}}-{{h.seventh_location|default_if_none:""}}</td>
	  		{% elif h.sixth_location %}
	  			<td>{{h.first_location}}-{{h.second_location|default_if_none:""}}-{{h.third_location|default_if_none:""}}-{{h.fourth_location|default_if_none:""}}-{{h.fifth_location|default_if_none:""}}-{{h.sixth_location|default_if_none:""}}</td>
	  		{% elif h.fifth_location %}
	  			<td>{{h.first_location}}-{{h.second_location|default_if_none:""}}-{{h.third_location|default_if_none:""}}-{{h.fourth_location|default_if_none:""}}-{{h.fifth_location|default_if_none:""}}</td>
	  		{% elif h.fourth_location %}
	  			<td>{{h.first_location}}-{{h.second_location|default_if_none:""}}-{{h.third_location|default_if_none:""}}-{{h.fourth_location|default_if_none:""}}</td>
	  		{% elif h.third_location %}
	  			<td>{{h.first_location}}-{{h.second_location|default_if_none:""}}-{{h.third_location|default_if_none:""}}</td>
	  		{% else %}
	  			<td>{{h.first_location}}-{{h.second_location|default_if_none:""}}</td>
	  		{% endif %}
			</p>
		{% endfor %}
    	</p>
		<td><a href="{% url 'update-piece-instance' piece_instance.id %}" class="btn btn-outline-secondary btn-sm">Update</a>
        <td><a href="{% url 'instance-clone' piece_instance.id %}" class="btn btn-outline-secondary btn-sm">Clone</a></td>
  	</div>
	</div>
{% endblock %}